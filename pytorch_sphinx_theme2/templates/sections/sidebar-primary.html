{# sidebar-primary.html #}
{# Override of pydata_sphinx_theme's sidebar-primary.html #}
{# This version hides the sidebar entirely when Section Navigation is empty #}

{% block docs_sidebar %}
{% if theme_navbar_center or theme_navbar_end or sidebars or theme_primary_sidebar_end %}

  {# Check if sidebar-nav-bs has actual toctree content #}
  {% set has_toctree_content = not suppress_sidebar_toctree(includehidden=theme_sidebar_includehidden | tobool) %}

  {# Generate the toctree HTML to check if it's truly empty #}
  {% if has_toctree_content %}
    {% set toctree_html = generate_toctree_html(
      "sidebar",
      show_nav_level=theme_show_nav_level | int,
      maxdepth=theme_navigation_depth | int,
      collapse=theme_collapse_navigation | tobool,
      includehidden=theme_sidebar_includehidden | tobool,
      titles_only=True
    ) %}
    {# Convert to string and check if it has meaningful content #}
    {% set toctree_str = toctree_html | string | trim %}
    {% if toctree_str == '' or toctree_str == 'None' %}
      {% set has_toctree_content = false %}
    {% endif %}
  {% endif %}

  {# Check if there's any other content besides the potentially empty toctree #}
  {% set has_header_items = theme_navbar_center or theme_navbar_end %}
  {% set has_primary_end = theme_primary_sidebar_end | length > 0 if theme_primary_sidebar_end else false %}
  {% set has_other_sidebars = sidebars | reject("in", "sidebar-nav-bs.html") | list | length > 0 %}

  {# Only render if there's actual content to show #}
  {% if has_toctree_content or has_header_items or has_primary_end or has_other_sidebars %}

  {# Header items that will be displayed in the sidebar on mobile #}
  <div class="sidebar-header-items sidebar-primary__section">
    {# The header center items #}
    {% if theme_navbar_center %}
      <div class="sidebar-header-items__center">
        {% for navbar_item in theme_navbar_center %}
          {#
            In the mobile sidebar we do not want a dropdown, so set a large cutoff (999).
          #}
          {% with theme_header_links_before_dropdown=999 %}
            <div class="navbar-item">{% include navbar_item %}</div>
          {% endwith %}
        {% endfor %}
      </div>
    {% endif %}
    {# The header end items #}
    {% if theme_navbar_end %}
      <div class="sidebar-header-items__end">
        {% for navbar_item in theme_navbar_end %}
          <div class="navbar-item">{% include navbar_item %}</div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  {# Only include sidebars that have content #}
  {% if sidebars %}
    <div class="sidebar-primary-items__start sidebar-primary__section">
      {%- for sidebartemplate in sidebars %}
        {# Skip sidebar-nav-bs if it has no content #}
        {% if sidebartemplate == "sidebar-nav-bs.html" and not has_toctree_content %}
          {# Skip empty section navigation #}
        {% else %}
          <div class="sidebar-primary-item">{%- include sidebartemplate %}</div>
        {% endif %}
      {%- endfor %}
    </div>
  {% endif %}

  {# Items that will snap to the bottom of the screen #}
  <div class="sidebar-primary-items__end sidebar-primary__section">
    {%- for sidebartemplate in theme_primary_sidebar_end %}
      <div class="sidebar-primary-item">{%- include sidebartemplate %}</div>
    {%- endfor %}
  </div>

  {# add the rtd flyout in the sidebar if existing #}
  <div id="rtd-footer-container"></div>

  {% endif %}
{% endif %}
{% endblock docs_sidebar %}
