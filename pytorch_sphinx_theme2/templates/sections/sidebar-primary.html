{# Override of sidebar-primary.html to hide sidebar when Section Navigation is empty #}
{# Uses suppress_sidebar_toctree(includehidden=False) to check for VISIBLE toctree content #}
{# This allows hidden toctrees to still work while hiding the sidebar when visible content is empty #}

{% block docs_sidebar %}
{# Check if there's VISIBLE toctree content (using includehidden=False) #}
{# This differs from the parent which uses theme_sidebar_includehidden (default True) #}
{% set has_visible_sidebar_toctree = not suppress_sidebar_toctree(includehidden=False) %}

{# Determine if we should show the sidebar at all #}
{# Show if: there's visible toctree content, OR we have mobile nav items to display #}
{% set show_sidebar = has_visible_sidebar_toctree or theme_navbar_center or theme_navbar_end or theme_primary_sidebar_end %}

{% if show_sidebar %}
  {# Header items that will be displayed in the sidebar on mobile #}
  <div class="sidebar-header-items sidebar-primary__section">
    {# The header center items #}
    {% if theme_navbar_center %}
      <div class="sidebar-header-items__center">
        {% for navbar_item in theme_navbar_center %}
          {# In the mobile sidebar we do not want a dropdown, so set a large cutoff (999). #}
          {% with theme_header_links_before_dropdown=999 %}
            <div class="navbar-item">{% include navbar_item %}</div>
          {% endwith %}
        {% endfor %}
      </div>
    {% endif %}
    {# The header end items #}
    {% if theme_navbar_end %}
      <div class="sidebar-header-items__end">
        {% for navbar_item in theme_navbar_end %}
          <div class="navbar-item">{% include navbar_item %}</div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  {# Only render Section Navigation if there's VISIBLE toctree content #}
  {% if sidebars and has_visible_sidebar_toctree %}
    <div class="sidebar-primary-items__start sidebar-primary__section">
      {%- for sidebartemplate in sidebars %}
        <div class="sidebar-primary-item">{%- include sidebartemplate %}</div>
      {%- endfor %}
    </div>
  {% endif %}

  {# Items that will snap to the bottom of the screen #}
  <div class="sidebar-primary-items__end sidebar-primary__section">
    {%- for sidebartemplate in theme_primary_sidebar_end %}
      <div class="sidebar-primary-item">{%- include sidebartemplate %}</div>
    {%- endfor %}
  </div>
  {# add the rtd flyout in the sidebar if existing #}
  <div id="rtd-footer-container"></div>
{% endif %}
{% endblock docs_sidebar %}
